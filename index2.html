<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pixel Distance Measurement</title>
    <style>
        #container {
            position: relative;
            width: 500px; /* Set the width and height of your container */
            height: 500px;
            border: 1px solid black;
            background-size: cover;
            background-position: center;
        }
        .point {
            position: absolute;
            width: 10px; /* Set the size of your point */
            height: 10px;
            background-color: red; /* Set the color of your point */
            border-radius: 50%; /* Make the point circular */
            opacity: 0.5; /* Set transparency to 50% */
        }
        .line {
            position: absolute;
            border-bottom: 2px solid red; /* Set the color and width of the line */
            opacity: 0.5; /* Set transparency to 50% */
        }
        #square {
            position: absolute;
            width: 100px; /* Initial size of the square (100x100 pixels) */
            height: 100px;
            background-color: blue; /* Set the color of the square */
        }
    </style>
</head>
<body>
    <div id="container" onclick="handleClick(event)">
        <!-- Points will be dynamically added here -->
        <div id="square"></div>
    </div>

    <p id="distance"></p>

    <label for="realSize">Real Size of the Line (cm):</label>
    <input type="number" id="realSize" onchange="updateSquareSize()" step="any">

    <label for="realSquareSize">Real Size of the Square (cm):</label>
    <input type="number" id="realSquareSize" onchange="updateSquareSize()" step="any">

    <input type="file" id="imageInput" accept="image/*" onchange="setImageBackground(event)">

    <button onclick="resetMeasurement()">Reset</button>

    <script>
        let points = [];
        const initialSquareSize = 100; // Initial size of the square in cm

        function handleClick(event) {
            const container = document.getElementById('container');
            const rect = container.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;

            points.push({ x, y });

            if (points.length === 2) {
                const distance = Math.sqrt(
                    Math.pow(points[1].x - points[0].x, 2) +
                    Math.pow(points[1].y - points[0].y, 2)
                );

                document.getElementById('distance').innerText = `Distance: ${distance.toFixed(2)} pixels`;

                // Calculate the size of the square based on the real size of the line and square
                const realSize = parseFloat(document.getElementById('realSize').value);
                const realSquareSize = parseFloat(document.getElementById('realSquareSize').value);
                if (!isNaN(realSize) && realSize > 0 && !isNaN(realSquareSize) && realSquareSize > 0) {
                    const scale = (realSquareSize / realSize) * distance; // Adjusted scale based on ratio
                    document.getElementById('square').style.width = `${scale}px`;
                    document.getElementById('square').style.height = `${scale}px`;

                    // Draw line
                    drawLine(points[0].x, points[0].y, points[1].x, points[1].y);
                }
            }

            if (points.length > 2) {
                points = points.slice(1); // Reset points array after the second click
            }

            drawPoint(x, y);
        }

        function drawPoint(x, y) {
            const container = document.getElementById('container');
            const point = document.createElement('div');
            point.className = 'point';
            point.style.left = `${x}px`;
            point.style.top = `${y}px`;
            container.appendChild(point);
        }

        function drawLine(x1, y1, x2, y2) {
            const container = document.getElementById('container');
            const line = document.createElement('div');
            line.className = 'line';
            const length = Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
            const angle = Math.atan2(y2 - y1, x2 - x1) * 180 / Math.PI;
            line.style.width = `${length}px`;
            line.style.left = `${x1}px`;
            line.style.top = `${y1}px`;
            line.style.transform = `rotate(${angle}deg)`;
            container.appendChild(line);
        }

        function resetMeasurement() {
            points = [];
            const container = document.getElementById('container');
            while (container.firstChild) {
                container.removeChild(container.firstChild);
            }
            document.getElementById('distance').innerText = '';
            container.style.backgroundImage = ''; // Reset background image
        }

        function updateSquareSize() {
            const realSize = parseFloat(document.getElementById('realSize').value);
            const realSquareSize = parseFloat(document.getElementById('realSquareSize').value);
            if (!isNaN(realSize) && realSize > 0 && !isNaN(realSquareSize) && realSquareSize > 0) {
                // Recalculate the size of the square based on the real size of the line
                const distance = parseFloat(document.getElementById('distance').innerText.split(':')[1]);
                const scale = (realSquareSize / realSize) * distance; // Adjusted scale based on ratio
                document.getElementById('square').style.width = `${scale}px`;
                document.getElementById('square').style.height = `${scale}px`;
            }
        }

        function setImageBackground(event) {
            const file = event.target.files[0];
            const reader = new FileReader();
            reader.onload = function(event) {
                const imageData = event.target.result;
                document.getElementById('container').style.backgroundImage = `url(${imageData})`;
            };
            reader.readAsDataURL(file);
        }
    </script>
</body>
</html>
