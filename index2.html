<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pixel Distance Measurement</title>
    <style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f0f0f0;
        margin: 0;
        padding: 0;
    }
     
    #container {
        position: relative;
        width: 500px;
        height: 500px;
        border: 1px solid #ddd;
        background-size: cover;
        background-position: center;
        margin: 20px auto;
        overflow: hidden;
    }
    .point {
        position: absolute;
        width: 10px;
        height: 10px;
        background-color: red;
        border-radius: 50%;
    }
    #square {
        position: absolute;
        width: 100px;
        height: 100px;
        cursor: move;
        background-image: url('image1.jpg');
        background-size: cover;
        background-position: center;
        box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.3);
        transform: translate(-50%, -50%) perspective(500px) rotateY(0deg);
        top: 50%;
        left: 50%;
        margin-top: -50px;
        margin-left: -50px;
    }

    .thumbnail {
        width: 50px;
        height: 50px;
        cursor: pointer;
        margin-right: 10px;
        border-radius: 5px;
        transition: transform 0.3s ease;
    }

    .thumbnail:hover {
        transform: scale(1.1);
    }

    #imageButtons {
        text-align: center;
        margin-bottom: 20px;
    }

    #realSizeLabel {
        display: block;
        margin-bottom: 10px;
    }

    #realSize {
        width: 100px;
        padding: 5px;
        border-radius: 5px;
        border: 1px solid #ddd;
        margin-bottom: 10px;
        font-size: 14px;
    }

    #uploadBtn {
        display: block;
        padding: 10px 20px;
        background-color: #4CAF50;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin: 0 auto 20px;
    }

    #uploadBtn:hover {
        background-color: #45a049;
    }

    #pointsBtn {
        display: block;
        padding: 10px 20px;
        background-color: #f44336;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
    }

    #pointsBtn:hover {
        background-color: #d32f2f;
    }

    .sliderContainer {
        text-align: center;
        margin-bottom: 20px;
    }

    .slider {
        width: 80%;
        -webkit-appearance: none;
        appearance: none;
        height: 5px;
        border-radius: 5px;
        background: #ddd;
        outline: none;
        opacity: 0.7;
        -webkit-transition: .2s;
        transition: opacity .2s;
    }

    .slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 15px;
        height: 15px;
        border-radius: 50%;
        background: #4CAF50;
        cursor: pointer;
    }

    .slider::-moz-range-thumb {
        width: 15px;
        height: 15px;
        border-radius: 50%;
        background: #4CAF50;
        cursor: pointer;
    }
    </style>
</head>
<body>
    <div id="container" onclick="handleClick(event)">
        <div id="square"></div>
    </div>

    <div id="imageButtons">
        <img class="thumbnail" src="image1.jpg" alt="Image 1" onclick="setImage('image1.jpg')">
        <img class="thumbnail" src="image2.jpg" alt="Image 2" onclick="setImage('image2.jpg')">
        <img class="thumbnail" src="image3.jpg" alt="Image 3" onclick="setImage('image3.jpg')">
    </div>
    
    <label id="realSizeLabel" for="realSize">Real Size of the Line (cm):</label>
    <input type="number" id="realSize" onchange="updateSquareSize()" step="any">

    <button id="uploadBtn" onclick="document.getElementById('imageInput').click()">Upload Photo</button>

    <button id="pointsBtn" onclick="togglePoints()">Toggle Points</button>

    <div class="sliderContainer">
        <input type="range" min="-45" max="45" value="0" class="slider" id="slider">
    </div>

    <input type="file" id="imageInput" accept="image/*" style="display: none" onchange="setImageBackground(event)">

    <script>
        let points = [];
        const initialSquareSize = 101;
        let isDragging = false;
        let offsetX, offsetY;
        let pointsVisible = true;

        function handleClick(event) {
            if (!pointsVisible) return;
            const container = document.getElementById('container');
            const rect = container.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;

            points.push({ x, y });

            if (points.length === 2) {
                const distance = Math.sqrt(
                    Math.pow(points[1].x - points[0].x, 2) +
                    Math.pow(points[1].y - points[0].y, 2)
                );

                const realSize = parseFloat(document.getElementById('realSize').value);
                if (!isNaN(realSize) && realSize > 0) {
                    const scale = (initialSquareSize / realSize) * distance;
                    document.getElementById('square').style.width = `${scale}px`;
                    document.getElementById('square').style.height = `${scale}px`;
                }
            }

            if (points.length > 2) {
                points = points.slice(1);
            }

            drawPoint(x, y);
        }

        function drawPoint(x, y) {
            const container = document.getElementById('container');
            const point = document.createElement('div');
            point.className = 'point';
            point.style.left = `${x}px`;
            point.style.top = `${y}px`;
            container.appendChild(point);
        }

        function updateSquareSize() {
            const realSize = parseFloat(document.getElementById('realSize').value);
            if (!isNaN(realSize) && realSize > 0) {
                const distance = calculateDistance();
                const scale = (initialSquareSize / realSize) * distance;
                document.getElementById('square').style.width = `${scale}px`;
                document.getElementById('square').style.height = `${scale}px`;
            }
        }

        function calculateDistance() {
            if (points.length === 2) {
                return Math.sqrt(
                    Math.pow(points[1].x - points[0].x, 2) +
                    Math.pow(points[1].y - points[0].y, 2)
                );
            }
            return 0;
        }

        function setImage(imageUrl) {
            document.getElementById('square').style.backgroundImage = `url(${imageUrl})`;
        }

        function setImageBackground(event) {
            const file = event.target.files[0];
            const reader = new FileReader();
            reader.onload = function(event) {
                const imageData = event.target.result;
                document.getElementById('container').style.backgroundImage = `url(${imageData})`;
            };
            reader.readAsDataURL(file);
        }

        const square = document.getElementById('square');
        const slider = document.getElementById('slider');

        slider.addEventListener('input', function() {
            const value = parseInt(this.value);
            square.style.transform = `translate(-50%, -50%) perspective(500px) rotateY(${value}deg)`;
        });

        square.addEventListener('mousedown', startDrag);

        function startDrag(event) {
            isDragging = true;
            const squareRect = square.getBoundingClientRect();
            offsetX = event.clientX - (squareRect.left + squareRect.width / 2);
            offsetY = event.clientY - (squareRect.top + squareRect.height / 2);
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', endDrag);
        }

        function endDrag() {
            isDragging = false;
            document.removeEventListener('mousemove', drag);
            document.removeEventListener('mouseup', endDrag);
        }

        function drag(event) {
            if (isDragging) {
                const container = document.getElementById('container');
                const rect = container.getBoundingClientRect();
                let newX = event.clientX - rect.left - offsetX;
                let newY = event.clientY - rect.top - offsetY;

                newX = Math.max(0, Math.min(newX, container.clientWidth - square.offsetWidth));
                newY = Math.max(0, Math.min(newY, container.clientHeight - square.offsetHeight));

                square.style.left = `${newX}px`;
                square.style.top = `${newY}px`;
            }
        }

        function togglePoints() {
            const points = document.getElementsByClassName('point');
            for (let i = 0; i < points.length; i++) {
                points[i].style.display = points[i].style.display === 'none' ? 'block' : 'none';
            }
            pointsVisible = !pointsVisible;
        }
    </script>
</body>
</html>
