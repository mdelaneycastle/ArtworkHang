<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pixel Distance Measurement</title>
    <style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f0f0f0;
        margin: 0;
        padding: 0;
    }
     
    #container {
        position: relative;
        width: 500px;
        height: 500px;
        border: 1px solid #ddd;
        background-size: cover;
        background-position: center;
        margin: 20px auto;
        overflow: hidden;
    }
    .point {
        position: absolute;
        width: 10px;
        height: 10px;
        background-color: red;
        border-radius: 50%;
    }
    #square {
    position: absolute;
    width: 100px;
    height: 100px;
    cursor: move;
    background-image: url('image1.jpg');
    background-size: cover;
    background-position: center;
    box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.3);
    transform: translate(-50%, -50%) perspective(500px) rotateY(0deg);
    top: 50%;
    left: 50%;
    margin-top: -50px;
    margin-left: -50px;
}


    .thumbnail {
    width: 150px; /* Set a fixed width */
    height: 150px; /* Set a fixed height */
    cursor: pointer;
    margin-right: 10px;
    border-radius: 5px;
    background-size: cover;
    background-position: center;
    transition: transform 0.3s ease;
}

/* For rectangular images, adjust the height to maintain aspect ratio */
.thumbnail.rectangular {
    height: auto;
    width: 150px; /* Set a fixed width */
}


    .thumbnail:hover {
        transform: scale(1.1);
    }

    #imageButtons {
        text-align: center;
        margin-bottom: 20px;
    }

    #realSizeLabel {
        display: block;
        margin-bottom: 10px;
        text-align: center;
    }

    #realSize {
        width: 100px;
        padding: 5px;
        border-radius: 5px;
        border: 1px solid #ddd;
        margin-bottom: 10px;
        font-size: 14px;
        display: block;
        margin: 0 auto;
    }

    #uploadBtn {
        display: block;
        padding: 10px 20px;
        background-color: #4CAF50;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin: 0 auto 20px;
    }

    #uploadBtn:hover {
        background-color: #45a049;
    }

    #pointsBtn {
        display: block;
        padding: 10px 20px;
        background-color: #f44336;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin: 20px auto;
    }

    #pointsBtn:hover {
        background-color: #d32f2f;
        margin-bottom: 20px;
    }

    .sliderContainer {
        text-align: center;
        margin-bottom: 20px;
    }

    .slider {
        width: 80%;
        -webkit-appearance: none;
        appearance: none;
        height: 5px;
        border-radius: 5px;
        background: #ddd;
        outline: none;
        opacity: 0.7;
        -webkit-transition: .2s;
        transition: opacity .2s;
    }

    .slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 15px;
        height: 15px;
        border-radius: 50%;
        background: #4CAF50;
        cursor: pointer;
    }

    .slider::-moz-range-thumb {
        width: 15px;
        height: 15px;
        border-radius: 50%;
        background: #4CAF50;
        cursor: pointer;
    }
    </style>
</head>
<body>
    <div id="container" onclick="handleClick(event)">
        <div id="square"></div>
    </div>

    <div id="imageButtons"></div>
    
    <!-- Add a back button -->
    <button id="backButton" style="display: none;" onclick="goBack()">Back to Artists</button>

    <label id="realSizeLabel" for="realSize">Real Size of the Line (cm):</label>
    <input type="number" id="realSize" onchange="updateSquareSize()" step="any">

    <button id="uploadBtn" onclick="document.getElementById('imageInput').click()">Upload Photo</button>

    <button id="pointsBtn" onclick="togglePoints()">- Toggle Points -</button>

    <div class="sliderContainer">
        <input type="range" min="-45" max="45" value="0" class="slider" id="slider">
    </div>

    <input type="file" id="imageInput" accept="image/*" style="display: none" onchange="setImageBackground(event)">


    <script>
        let points = [];
        const initialSquareSize = 101;
        let isDragging = false;
        let offsetX, offsetY;
        let pointsVisible = true;

        function handleClick(event) {
            if (!pointsVisible) return;
            const container = document.getElementById('container');
            const rect = container.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;

            points.push({ x, y });

            if (points.length === 2) {
                const distance = Math.sqrt(
                    Math.pow(points[1].x - points[0].x, 2) +
                    Math.pow(points[1].y - points[0].y, 2)
                );

                const realSize = parseFloat(document.getElementById('realSize').value);
                if (!isNaN(realSize) && realSize > 0) {
                    const scale = (initialSquareSize / realSize) * distance;
                    document.getElementById('square').style.width = `${scale}px`;
                    document.getElementById('square').style.height = `${scale}px`;
                }
            }

            if (points.length > 2) {
                points = points.slice(1);
            }

            drawPoint(x, y);
        }

        function drawPoint(x, y) {
            const container = document.getElementById('container');
            const point = document.createElement('div');
            point.className = 'point';
            point.style.left = `${x}px`;
            point.style.top = `${y}px`;
            container.appendChild(point);
        }

        function updateSquareSize() {
            const realSize = parseFloat(document.getElementById('realSize').value);
            if (!isNaN(realSize) && realSize > 0) {
                const distance = calculateDistance();
                const scale = (initialSquareSize / realSize) * distance;
                document.getElementById('square').style.width = `${scale}px`;
                document.getElementById('square').style.height = `${scale}px`;
            }
        }

        function calculateDistance() {
            if (points.length === 2) {
                return Math.sqrt(
                    Math.pow(points[1].x - points[0].x, 2) +
                    Math.pow(points[1].y - points[0].y, 2)
                );
            }
            return 0;
        }

        function setImage(imageUrl) {
    const square = document.getElementById('square');
    const img = new Image();
    img.src = imageUrl;
    img.onload = function() {
        const aspectRatio = img.width / img.height;
        const squareSize = aspectRatio >= 1 ? '100px' : `${100 * aspectRatio}px`;
        square.style.width = squareSize;
        square.style.height = squareSize;
        square.style.backgroundImage = `url(${imageUrl})`;
    };
}

        function setImageBackground(event) {
            const file = event.target.files[0];
            const reader = new FileReader();
            reader.onload = function(event) {
                const imageData = event.target.result;
                document.getElementById('container').style.backgroundImage = `url(${imageData})`;
            };
            reader.readAsDataURL(file);
        }

        const square = document.getElementById('square');
        const slider = document.getElementById('slider');

        slider.addEventListener('input', function() {
            const value = parseInt(this.value);
            square.style.transform = `translate(-50%, -50%) perspective(500px) rotateY(${value}deg)`;
        });

        square.addEventListener('mousedown', startDrag);
        square.addEventListener('touchstart', startDragTouch);

        function startDrag(event) {
            isDragging = true;
            const squareRect = square.getBoundingClientRect();
            offsetX = event.clientX - (squareRect.left + squareRect.width / 2);
            offsetY = event.clientY - (squareRect.top + squareRect.height / 2);
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', endDrag);
        }

        function startDragTouch(event) {
            isDragging = true;
            const squareRect = square.getBoundingClientRect();
            offsetX = event.touches[0].clientX - (squareRect.left + squareRect.width / 2);
            offsetY = event.touches[0].clientY - (squareRect.top + squareRect.height / 2);
            document.addEventListener('touchmove', dragTouch);
            document.addEventListener('touchend', endDrag);
        }

        function endDrag() {
            isDragging = false;
            document.removeEventListener('mousemove', drag);
            document.removeEventListener('touchmove', dragTouch);
            document.removeEventListener('mouseup', endDrag);
            document.removeEventListener('touchend', endDrag);
        }

        function drag(event) {
            if (isDragging) {
                const container = document.getElementById('container');
                const square = document.getElementById('square');
                const containerRect = container.getBoundingClientRect();

                let newX = event.clientX - containerRect.left - offsetX;
                let newY = event.clientY - containerRect.top - offsetY;

                newX = Math.max(0, Math.min(newX, containerRect.width - square.offsetWidth));
                newY = Math.max(0, Math.min(newY, containerRect.height - square.offsetHeight));

                // Adjust newX and newY to ensure the square stays within the container bounds
                newX = Math.min(newX, containerRect.width - square.offsetWidth);
                newY = Math.min(newY, containerRect.height - square.offsetHeight);

                square.style.left = `${newX}px`;
                square.style.top = `${newY}px`;
            }
        }

        function dragTouch(event) {
            if (isDragging) {
                const container = document.getElementById('container');
                const square = document.getElementById('square');
                const containerRect = container.getBoundingClientRect();

                let newX = event.touches[0].clientX - containerRect.left - offsetX;
                let newY = event.touches[0].clientY - containerRect.top - offsetY;

                newX = Math.max(0, Math.min(newX, containerRect.width - square.offsetWidth));
                newY = Math.max(0, Math.min(newY, containerRect.height - square.offsetHeight));

                // Adjust newX and newY to ensure the square stays within the container bounds
                newX = Math.min(newX, containerRect.width - square.offsetWidth);
                newY = Math.min(newY, containerRect.height - square.offsetHeight);

                square.style.left = `${newX}px`;
                square.style.top = `${newY}px`;
            }
        }

        function togglePoints() {
            const points = document.getElementsByClassName('point');
            for (let i = 0; i < points.length; i++) {
                points[i].style.display = points[i].style.display === 'none' ? 'block' : 'none';
            }
            pointsVisible = !pointsVisible;
        }

       fetch('images.json')
            .then(response => response.json())
            .then(data => {
                const imageButtonsContainer = document.getElementById('imageButtons');

                data.forEach(artist => {
                    const artistButton = document.createElement('button');
                    artistButton.textContent = artist.artist;
                    artistButton.onclick = () => displayArtistImages(artist.images);
                    imageButtonsContainer.appendChild(artistButton);
                });
            })
            .catch(error => console.error('Error fetching images:', error));

        function displayArtistImages(images) {
    const imageButtonsContainer = document.getElementById('imageButtons');
    imageButtonsContainer.innerHTML = ''; // Clear previous buttons

    images.forEach(image => {
        const imgElement = document.createElement('img');
        imgElement.className = 'thumbnail';
        imgElement.src = image.name;
        imgElement.alt = image.title;

        // Check if the image is rectangular
        if (image.width > image.height) {
            imgElement.classList.add('rectangular');
        }

        imgElement.onclick = () => setImage(image.name);
        imageButtonsContainer.appendChild(imgElement);
    });

    // Show the back button
    document.getElementById('backButton').style.display = 'block';
}

        function goBack() {
            // Clear the image display area
            const imageButtonsContainer = document.getElementById('imageButtons');
            imageButtonsContainer.innerHTML = '';

            // Re-display the artist selection buttons
            fetch('images.json')
                .then(response => response.json())
                .then(data => {
                    const imageButtonsContainer = document.getElementById('imageButtons');

                    data.forEach(artist => {
                        const artistButton = document.createElement('button');
                        artistButton.textContent = artist.artist;
                        artistButton.onclick = () => displayArtistImages(artist.images);
                        imageButtonsContainer.appendChild(artistButton);
                    });
                })
                .catch(error => console.error('Error fetching images:', error));

            // Hide the back button again
            document.getElementById('backButton').style.display = 'none';
        }
    </script>
</body>
</html>
