<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Floor Plan</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
        #floor-plan {
            width: 1200px;
            height: 400px;
            border: 2px solid #000;
            position: relative;
            background-color: #fff;
        }
        .block {
            width: 50px;
            height: 30%; /* Percentage height based on the calculation */
            background-color: #3498db;
            position: absolute;
            cursor: move;
            transform-origin: center center;
        }
        .rotate-handle {
            width: 10px;
            height: 10px;
            background-color: #e74c3c;
            position: absolute;
            top: -15px;
            right: -15px;
            cursor: pointer;
        }
        button {
            position: absolute;
            top: 10px;
            left: 10px;
        }
    </style>
</head>
<body>
    <div id="floor-plan">
        <button onclick="addBlock()">Add Block</button>
    </div>
    <script>
        let blockCounter = 0;

        function addBlock() {
            const block = document.createElement('div');
            block.classList.add('block');
            block.style.left = '10px';
            block.style.top = '10px';
            block.id = 'block-' + blockCounter;
            blockCounter++;

            const rotateHandle = document.createElement('div');
            rotateHandle.classList.add('rotate-handle');
            block.appendChild(rotateHandle);

            block.onmousedown = startDrag;
            rotateHandle.onmousedown = startRotate;
            document.getElementById('floor-plan').appendChild(block);
        }

        function startDrag(event) {
            const block = event.target.closest('.block');
            let shiftX = event.clientX - block.getBoundingClientRect().left;
            let shiftY = event.clientY - block.getBoundingClientRect().top;

            function moveAt(pageX, pageY) {
                let newLeft = pageX - shiftX;
                let newTop = pageY - shiftY;

                // Boundary conditions
                if (newLeft < 0) {
                    newLeft = 0;
                }
                if (newTop < 0) {
                    newTop = 0;
                }
                if (newLeft + block.offsetWidth > floorPlan.offsetWidth) {
                    newLeft = floorPlan.offsetWidth - block.offsetWidth;
                }
                if (newTop + block.offsetHeight > floorPlan.offsetHeight) {
                    newTop = floorPlan.offsetHeight - block.offsetHeight;
                }

                block.style.left = newLeft + 'px';
                block.style.top = newTop + 'px';
            }

            function onMouseMove(event) {
                moveAt(event.pageX, event.pageY);
            }

            moveAt(event.pageX, event.pageY); // Move to the initial position on mousedown

            document.addEventListener('mousemove', onMouseMove);

            function onMouseUp() {
                document.removeEventListener('mousemove', onMouseMove);
                block.onmouseup = null;
            }

            document.addEventListener('mouseup', onMouseUp, { once: true });

            block.ondragstart = function() {
                return false;
            };
        }

        function startRotate(event) {
            event.stopPropagation();
            const block = event.target.closest('.block');
            const rect = block.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;

            function onMouseMove(event) {
                const deltaX = event.clientX - centerX;
                const deltaY = event.clientY - centerY;
                const angle = Math.atan2(deltaY, deltaX) * (180 / Math.PI);

                // Snap angle to nearest 45 degrees
                const snappedAngle = Math.round(angle / 45) * 45;
                block.style.transform = `rotate(${snappedAngle}deg)`;
            }

            document.addEventListener('mousemove', onMouseMove);

            function onMouseUp() {
                document.removeEventListener('mousemove', onMouseMove);
                document.removeEventListener('mouseup', onMouseUp);
            }

            document.addEventListener('mouseup', onMouseUp, { once: true });
        }

        const floorPlan = document.getElementById('floor-plan');
    </script>
</body>
</html>
