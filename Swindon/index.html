<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Floor Plan.</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
        #controls {
            margin-bottom: 10px;
        }
        #floor-plan {
            width: 1200px;
            height: 400px;
            border: 2px solid #000;
            position: relative;
            background: url('floor.png') no-repeat center center;
            background-size: cover;
        }
        .block, .item {
            position: absolute;
            cursor: move;
            transform-origin: center center; /* Rotate around the center */
        }
        .block {
            width: 30px;
            height: 30%; /* 30% of the floor plan height */
            background-color: #d8d1c5;
        }
        .resize-handle {
            width: 10px;
            height: 10px;
            background-color: #2ecc71;
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translate(-50%, 50%); /* Center the handle */
            cursor: ns-resize;
        }
        .rotate-handle {
            width: 10px;
            height: 10px;
            background-color: #e74c3c;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%); /* Center the handle */
            cursor: pointer;
            display: block; /* Initially visible */
        }
        .item img {
            width: 100%;
            height: auto; /* Maintain aspect ratio */
            box-shadow: 10px 10px rgba(0, 0, 0, 0.3);
        }
        .archway {
            width: 100%; /* Full width of the floor plan */
            height: 100%; /* Full height of the floor plan */
            position: absolute;
            top: 0;
            left: 50%;
            pointer-events: none; /* Make it non-interactive */
        }
    </style>
</head>
<body>
    <div id="floor-plan">
        <div class="archway">
            <img src="archway.png" alt="Archway">
        </div>
    </div>
    <div id="controls">
        <button onclick="addBlock()">Add Block</button>
        <button onclick="addItem('coffee.png', 200)">Add Coffee Table</button>
        <button onclick="addItem('settee.png', 300)">Add Sofa</button>
        <button onclick="addItem('desk.png', 250)">Add Desk</button>
        <button onclick="addItem('bar.png', 400)">Add Bar and Stools</button>
        <button onclick="toggleHandles()">Toggle Handles</button>
    </div>
    <script>
        let blockCounter = 0;

        function addBlock() {
            const block = document.createElement('div');
            block.classList.add('block');
            block.style.left = '10px';
            block.style.top = '10px';
            block.id = 'block-' + blockCounter;
            blockCounter++;

            const rotateHandle = document.createElement('div');
            rotateHandle.classList.add('rotate-handle');
            block.appendChild(rotateHandle);

            const resizeHandle = document.createElement('div');
            resizeHandle.classList.add('resize-handle');
            block.appendChild(resizeHandle);

            block.onmousedown = startDrag;
            rotateHandle.onmousedown = startRotate;
            resizeHandle.onmousedown = startResize;

            document.getElementById('floor-plan').appendChild(block);
        }

        function addItem(imageSrc, width) {
            const item = document.createElement('div');
            item.classList.add('item');
            item.style.width = width + 'px';
            item.style.left = '10px';
            item.style.top = '10px';

            const img = document.createElement('img');
            img.src = imageSrc;
            img.style.width = '100%';
            img.style.height = 'auto'; // Maintain aspect ratio
            item.appendChild(img);

            const rotateHandle = document.createElement('div');
            rotateHandle.classList.add('rotate-handle');
            item.appendChild(rotateHandle);

            item.onmousedown = startDrag;
            rotateHandle.onmousedown = startRotate;
            document.getElementById('floor-plan').appendChild(item);
        }

        function startDrag(event) {
            const block = event.target.closest('.block, .item');
            let shiftX = event.clientX - block.getBoundingClientRect().left;
            let shiftY = event.clientY - block.getBoundingClientRect().top;

            function moveAt(pageX, pageY) {
                let newLeft = pageX - shiftX;
                let newTop = pageY - shiftY;

                // Boundary conditions
                if (newLeft < 0) {
                    newLeft = 0;
                }
                if (newTop < 0) {
                    newTop = 0;
                }
                if (newLeft + block.offsetWidth > floorPlan.offsetWidth) {
                    newLeft = floorPlan.offsetWidth - block.offsetWidth;
                }
                if (newTop + block.offsetHeight > floorPlan.offsetHeight) {
                    newTop = floorPlan.offsetHeight - block.offsetHeight;
                }

                block.style.left = newLeft + 'px';
                block.style.top = newTop + 'px';
            }

            function onMouseMove(event) {
                moveAt(event.pageX, event.pageY);
            }

            moveAt(event.pageX, event.pageY); // Move to the initial position on mousedown

            document.addEventListener('mousemove', onMouseMove);

            function onMouseUp() {
                document.removeEventListener('mousemove', onMouseMove);
                block.onmouseup = null;
            }

            document.addEventListener('mouseup', onMouseUp, { once: true });

            block.ondragstart = function() {
                return false;
            };
        }

        function startRotate(event) {
            event.stopPropagation();
            const block = event.target.closest('.block, .item');
            const rect = block.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;

            function onMouseMove(event) {
                const deltaX = event.clientX - centerX;
                const deltaY = event.clientY - centerY;
                const angle = Math.atan2(deltaY, deltaX) * (180 / Math.PI);

                // Snap angle to nearest 45 degrees
                const snappedAngle = Math.round(angle / 45) * 45;
                block.style.transform = `rotate(${snappedAngle}deg)`;
            }

            document.addEventListener('mousemove', onMouseMove);

            function onMouseUp() {
                document.removeEventListener('mousemove', onMouseMove);
                document.removeEventListener('mouseup', onMouseUp);
            }

            document.addEventListener('mouseup', onMouseUp, { once: true });
        }

        function startResize(event) {
            event.stopPropagation();
            const block = event.target.closest('.block');
            const startY = event.clientY;
            const startHeight = block.offsetHeight;

            function onMouseMove(event) {
                const newHeight = startHeight + (event.clientY - startY);
                if (newHeight > 10 && newHeight < floorPlan.offsetHeight) { // Add some boundary conditions
                    block.style.height = newHeight + 'px';
                }
            }

            document.addEventListener('mousemove', onMouseMove);

            function onMouseUp() {
                document.removeEventListener('mousemove', onMouseMove);
                document.removeEventListener('mouseup', onMouseUp);
            }

            document.addEventListener('mouseup', onMouseUp, { once: true });
        }

        function toggleHandles() {
            const handles = document.querySelectorAll('.rotate-handle, .resize-handle');
            handles.forEach(handle => {
                handle.style.display = handle.style.display === 'none' ? 'block' : 'none';
            });
        }

        const floorPlan = document.getElementById('floor-plan');
    </script>
</body>
</html>
